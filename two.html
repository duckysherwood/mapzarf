<html>
  <head>
    <title>Mercator and Cartographic Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/thirdparty/leaflet/Leaflet-0.6.4/leaflet.css">
    <link rel="stylesheet" href="./taxRoi.css">
  </head>
  <body>

     <div id="map"></div>
     <div id="legend">
       <img id="legendImage" src="/tiles/clearTile.png"
            alt="Legend">
     </div>
     <div id="sidebar">
       <p id="explanation"></p>

       In the cartogram, a state's area is proportional to the state's 
       population.

       <a id="sharingUrl" href="">Shareable link to this view</a><p />

       <div id="choroplethLayers"></div><p />
       <div id="dotLayers"></div><p />
       <div id="borderLayers"></div><p />

       <input type="checkbox" id="showCitiesCheckbox" checked>Show city names<p />
       <div id="cartogramSelector"></div>
       
     </div>
  
    <script src="/thirdparty/leaflet/Leaflet-0.6.4/leaflet.js" type="text/javascript"></script>
    <script type="text/javascript" 
            src="/thirdparty/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="./omni.js"></script>
    <script type="text/javascript" src="./Utilities.js"></script>
    <script type="text/javascript" src="./MapDisplayParameters.js"></script>
    <script type="text/javascript" src="./DomCreator.js"></script>
    <script type="text/javascript" src="./MapBehaviorInitializer.js"></script>
    <script type="text/javascript" src="./ListenerInitializer.js"></script>
    <script type="text/javascript" src="./CityLabeller.js"></script>
    <script type="text/javascript" src="./Tester.js"></script>
  
    <script type="text/javascript">

      var tester = new Tester()

      $(document).ready(function() {

        var mapDisplayParameters = new MapDisplayParameters()
        var ignoreThis = mapDisplayParameters
              .createDefaultsFromMapApplicationInfo(mapApplicationInfo)
        var queryString = mapDisplayParameters.getQueryString()
        ignoreThis = mapDisplayParameters
              .initializePageParametersFromQueryString(queryString)
        var pageInitValues = mapDisplayParameters
              .getValues()

        // tester.pageInitValuesTest()

        // TODO move this into another file
        // TODO look again at JS style guide
        // TODO add JSDoc
        // TODO put on GitHub
        // L (from Leaflet) is global scope, but we need map in this scope
        // so we can pass it to behaviour
        var myMap = L.map("map", {minZoom: 0, maxZoom: 14})

        var domCreator 
            = new DomCreator(myMap, mapApplicationInfo, pageInitValues)
        domCreator.createAndPopulateElements()

        var cityLabeller = new CityLabeller($( '#map' )[0], myMap)

        var mbc = 
            new MapBehaviorInitializer(myMap, mapApplicationInfo, cityLabeller)
        mbc.initialize()

        var listenerInitializer = 
          new ListenerInitializer(myMap, mapApplicationInfo, cityLabeller)
      
        cityLabeller.refreshCityLabels(cityLabeller)

      });
    </script>

  </body>
</html>
