<html>
  <head>
    <title>Mercator and Cartographic Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/thirdparty/leaflet/Leaflet-0.6.4/leaflet.css">
    <link rel="stylesheet" href="./taxRoi.css">
  </head>
  <body>

     <div id="map"></div>
     <div id="legend">
       <img id="legendImage" src="http://maps.webfoot.com/tiles/clearTile.png"
            alt="Legend">
     </div>
     <div id="sidebar">
       <p id="explanation"></p>

       In the cartogram, a state's area is proportional to the state's 
       population.

       <a id="sharingUrl" href="">Shareable link to this view</a><p />

       <div id="choroplethLayers"></div><p />
       <div id="dotLayers"></div><p />
       <div id="borderLayers"></div><p />

       <input type="checkbox" id="showCitiesCheckbox" checked>Show city names<p />
       <div id="cartogramSelector"></div>
       
     </div>
  
    <script src="/thirdparty/leaflet/Leaflet-0.6.4/leaflet.js" type="text/javascript"></script>
    <script type="text/javascript" 
            src="/thirdparty/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="./omni.js"></script>
    <script type="text/javascript" src="./Utilities.js"></script>
    <script type="text/javascript" src="./DomCreator.js"></script>
    <script type="text/javascript" src="./MapBehaviorInitializer.js"></script>
    <script type="text/javascript" src="./ListenerInitializer.js"></script>
    <script type="text/javascript" src="./CityLabeller.js"></script>
  
    <script type="text/javascript">

      // var initParam = initializePageParametersFromQueryString(mapApplicationInfo)
      $(document).ready(function() {

        // TODO move this into another file
        // TODO look again at JS style guide
        // TODO add JSDoc
        // TODO put on GitHub
        // L (from Leaflet) is global scope, but we need map in this scope
        // so we can pass it to behaviour
        var myMap = L.map("map", {minZoom: 0, maxZoom: 14})
        $.data( $( '#map' )[0], 'mapObject', myMap)

        var domCreator = new DomCreator(mapApplicationInfo)
        domCreator.createAndPopulateElements(myMap)

        var mbc = new MapBehaviorInitializer(myMap, mapApplicationInfo)
        mbc.initialize()

        cityLabeller = new CityLabeller($( '#map' )[0], myMap)
        $.data( $( '#map' )[0], 'cityLabeller', cityLabeller)

        var listenerInitializer = 
          new ListenerInitializer(myMap, mapApplicationInfo, cityLabeller)
      
        var markers = new L.FeatureGroup()
        $.data( $( '#map' )[0], 'markers', markers)
        cityLabeller.refreshCityLabels()

      });
    </script>

  </body>
</html>
